---
import Layout from "../../layouts/Layout.astro";
import { ProjectGrid } from "../../components/react/ProjectGrid";
import { getLocalizedProjects } from "../../utils/projects";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";

export async function getStaticPaths() {
    return [{ params: { lang: "en" } }, { params: { lang: "es" } }];
}

const { lang } = Astro.params;
const t = useTranslations(lang as any);

// Fetch projects using localized logic (with EN fallback)
const projects = await getLocalizedProjects(lang);

// Map Astro content to React props
const projectProps = projects.map((p) => ({
    slug: p.slug,
    data: {
        title: p.data.title,
        description: p.data.description,
        tags: p.data.tags,
        link: p.data.link,
        image: p.data.image,
        featured: p.data.featured,
        inProgress: p.data.inProgress,
    },
}));

// Sanitize props to remove any potential non-POJO artifacts for hydration safety
const cleanProjectProps = JSON.parse(JSON.stringify(projectProps));
---

<Layout
    title={`Portfolio | ${t("nav.projects")}`}
    lang={lang}
    description={t("page.projectsDescription")}
>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
        <h1 class="text-4xl md:text-5xl font-heading font-bold text-light mb-8">
            <span
                class="text-transparent bg-clip-text bg-gradient-to-r from-gold to-white"
            >
                {t("nav.projects")}
            </span>
        </h1>

        <p class="text-xl text-gray-400 max-w-2xl mb-12">
            {t("page.projectsDescription")}
        </p>

        <ProjectGrid
            client:only="react"
            projects={cleanProjectProps}
            labels={{
                all: t("ui.all"),
                filter: t("ui.filterBy"),
            }}
        />
    </div>
</Layout>

---
import Layout from "../../layouts/Layout.astro";
import { CertificationList } from "../../components/react/CertificationList";
import { getCollection, type CollectionEntry } from "astro:content";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";

export function getStaticPaths() {
    return [{ params: { lang: "en" } }, { params: { lang: "es" } }];
}

const { lang } = Astro.params;
const t = useTranslations(lang as any);

type CertEntry = CollectionEntry<"certifications">;

const allCertifications = await getCollection("certifications");

// Map to safe props
const certProps = allCertifications.map((c) => ({
    id: c.id,
    data: {
        name: c.data.name,
        issuer: c.data.issuer,
        date: c.data.date,
        badge: c.data.badge?.startsWith("http")
            ? c.data.badge
            : import.meta.env.BASE_URL.replace(/\/$/, "") + c.data.badge,
        url: c.data.url,
        starred: c.data.starred,
    },
}));

// Sanitize for hydration
const cleanCertProps = JSON.parse(JSON.stringify(certProps));
---

<Layout title={`Portfolio | ${t("nav.certifications")}`} lang={lang}>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
        <h1 class="text-4xl md:text-5xl font-heading font-bold text-light mb-8">
            <span
                class="text-transparent bg-clip-text bg-gradient-to-r from-gold to-white"
            >
                {t("nav.certifications")}
            </span>
        </h1>

        <p class="text-xl text-gray-400 max-w-2xl mb-12">
            {
                lang === "en"
                    ? "Professional certifications and achievements validating my technical expertise."
                    : "Certificaciones profesionales y logros que validan mi experiencia técnica."
            }
        </p>

        <CertificationList
            client:only="react"
            certifications={cleanCertProps}
            labels={{
                sortBy: lang === "en" ? "Sort by Date" : "Ordenar por Fecha",
                sortDesc: lang === "en" ? "Newest" : "Más recientes",
                sortAsc: lang === "en" ? "Oldest" : "Más antiguos",
            }}
        />
    </div>
</Layout>
